// Generated by CoffeeScript 1.6.3
/*
# SGA Shared Canvas v0.133060
#
# **SGA Shared Canvas** is a shared canvas reader written in CoffeeScript.
#
# Date: Thu Oct 31 15:51:40 2013 -0400
#
# (c) Copyright University of Maryland 2012-2013.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
*/
(function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};(function(c,d){d.globalNamespace("SGA");return SGA.namespace("Reader",function(e){e.namespace("Data",function(e){e.namespace("StyleStore",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,a.call(b).concat([function(a){var b,c,d;c=a.options,b={},d=new RegExp("(?:\\.(\\S+)\\s*\\{\\s*([^}]*)\\s*\\})","mg"),a.addStyles=function(a,c){var e,f;if(b[a]==null){b[a]={},e=d.exec(c),f=[];while((e!=null?e.index:void 0)!=null)b[a][e[1]]=e[2],f.push(e=d.exec(c));return f}};return a.getStylesForClass=function(a,c){var d;return((d=b[a])!=null?d[c]:void 0)!=null?b[a][c]:""}}]))}}),e.namespace("TextStore",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,a.call(b).concat([function(a){var b,d,e,f;e=a.options,b={},d={},f={},a.addFile=function(a){var e,f,g,h;c.isArray(a)||(a=[a]),h=[];for(f=0,g=a.length;f<g;f++)e=a[f],h.push(function(a){if(a!=null&&b[a]==null&&d[a]==null){d[a]=[];return c.ajax({url:a,type:"GET",processData:!1,success:function(c){var e,f,g,h,i;e=c.documentElement.textContent,b[a]=e,i=d[a];for(g=0,h=i.length;g<h;g++)f=i[g],f(e);return delete d[a]}})}}(e));return h};return a.withFile=function(c,e){if(b[c]!=null)return e(b[c]);if(d[c]!=null)return d[c].push(e);a.addFile(c);return d[c].push(e)}}]))}});return e.namespace("Manifest",function(e){var f,g;f={"http://dms.stanford.edu/ns/":"sc","http://www.shared-canvas.org/ns/":"sc","http://www.w3.org/2000/01/rdf-schema#":"rdfs","http://www.w3.org/1999/02/22-rdf-syntax-ns#":"rdf","http://www.w3.org/2003/12/exif/ns#":"exif","http://purl.org/dc/elements/1.1/":"dc","http://www.w3.org/ns/openannotation/core/":"oa","http://www.openannotation.org/ns/":"oa","http://www.w3.org/ns/openannotation/extension/":"oax","http://www.openarchives.org/ore/terms/":"ore","http://www.shelleygodwinarchive.org/ns/1#":"sga","http://www.shelleygodwinarchive.org/ns1#":"sga","http://www.w3.org/2011/content#":"cnt","http://purl.org/dc/dcmitype/":"dctypes"},g={"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"item","http://www.w3.org/ns/openannotation/core/hasMotivation":"item"};return e.initInstance=function(){var e;e=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Data.Manifest"].concat(a.call(e),[function(a){var e,h,i,j,k,l,m,n,o;o=a.options,e=d.Data.Store.initInstance(),a.size=function(){return e.size()},k=d.Data.Importer.RDF_JSON.initInstance(e,f,g),n=[],j=function(d,e){{if(b.call(n,d)<0){n.push(d),a.addItemsToProcess(1);return c.ajax({url:d,type:"GET",contentType:"application/rdf+json",processData:!1,dataType:"json",success:function(b){a.addItemsProcessed(1);return a.importJSON(b,e)},error:function(b){a.addItemsProcessed(1);throw new Error("Could not load the manifest")}})}e()}},a.importJSON=function(a,b){var c;c=d.initSynchronizer(b),c.increment(),k["import"](a,function(a){var b,f;b=d.Data.Set.initInstance(a),f=e.getObjectsUnion(b,"oreisDescribedBy"),f.visit(function(a){c.increment();return j(a,c.decrement)});return c.decrement()});return c.done()},m=function(a){c.isArray(a)||(a=[a]),g=d.Data.Set.initInstance(a);return e.getSubjectsUnion(g,"type").items()},l=function(a){var b,f,g,h,i,j,k,l;c.isArray(a)||(a=[a]),f=d.Data.Set.initInstance(a),i=e.getSubjectsUnion(f,"oahasSource"),h=e.getSubjectsUnion(f,"oahasTarget"),g=e.getSubjectsUnion(i,"oahasTarget"),k=e.getObjectsUnion(g,"oahasBody"),l=e.getObjectsUnion(k,"oahasSource"),j=e.getSubjectsUnion(l,"oahasSource"),b=e.getSubjectsUnion(j,"oahasTarget").items();return b.concat(h.items(),g.items())},h=function(){var a;g=d.Data.Set.initInstance(["sgaSearchAnnotation"]),a=e.getSubjectsUnion(g,"type").items();return e.removeItems(a)},i=function(){var a,b,f,h,i,j,k;g=d.Data.Set.initInstance(["sgaSearchAnnotation"]),f=e.getSubjectsUnion(g,"type"),i=e.getObjectsUnion(f,"oahasTarget"),k=e.getObjectsUnion(i,"oahasSource"),h=e.getSubjectsUnion(k,"oahasSource"),a=e.getSubjectsUnion(h,"oahasBody"),j=e.getObjectsUnion(a,"oahasTarget"),b=e.getObjectsUnion(j,"oahasSource");return c.unique(b.items())},a.getCanvases=function(){return m("scCanvas")},a.getZones=function(){return m("scZone")},a.getSequences=function(){return m("scSequence")},a.getAnnotations=function(){return m("oaAnnotation")},a.getRanges=function(){return m("scRange")},a.getLayers=function(){return m("scLayer")},a.getManifests=function(){return m("scManifest")},a.getAnnotationsForCanvas=l,a.flushSearchResults=h,a.getSearchResultCanvases=i,a.getItem=e.getItem,a.contains=e.contains;return a.importFromURL=function(a,b){return j(a,function(){if(b!=null)return b()})}}]))}})}),e.namespace("Presentation",function(e){e.namespace("TextContent",function(e){return e.initInstance=function(){var e,f;e=1<=arguments.length?a.call(arguments,0):[];return(f=d.Presentation).initInstance.apply(f,["SGA.Reader.Presentation.TextContent"].concat(a.call(e),[function(a,d){var e,f,g,h,i,j,k,l,m,n;l=a.options,a.setHeight(0),a.events.onWidthChange.addListener(function(a){return c(d).attr("width",a/10)}),l.width!=null&&a.setWidth(l.width),l.x!=null&&a.setX(l.x),l.y!=null&&a.setY(l.y),l.height!=null&&a.setHeight(l.height),l.scale!=null&&a.setScale(l.scale),l.inHTML&&a.events.onScaleChange.addListener(function(a){var b,c,d,e;e=[];for(c=0,d=n.length;c<d;c++)b=n[c],e.push(b.setScale(a));return e}),k={},i={},j={},n=[],g=0,a.startDisplayUpdate=function(){k={};return g=0},a.finishDisplayUpdate=function(){var a,b,e,f,g,h,l,m,o,p,q,r,s,t,u,v;c(d).empty(),a=[],u=function(){var a;a=[];for(g in k)a.push(g);return a}().sort(function(a,b){return a-b});for(q=0,s=u.length;q<s;q++){h=u[q],e=c("<div></div>"),i[h]!=null&&e.css({"text-align":i[h]}),j[h]!=null&&(e.css,e.css({"padding-left":j[h]*1+"em"})),l=h-Math.floor(h),l<0&&(l+=1),l>.5?e.addClass("above-line"):l>0&&e.addClass("below-line"),c(d).append(e),f=0,b=0,v=k[h],p=function(d){d.setScale!=null&&n.push(d);if(d.$el!=null){d.positioned&&(f=d.charLead,a[b]!=null?a[b].push(d.afterLayout):a[b]=[d.afterLayout]),c(e).append(d.$el),d.$el.attr("data-pos",f),d.$el.attr("data-line",h);return f+=d.charWidth||0}};for(r=0,t=v.length;r<t;r++)m=v[r],p(m)}o=function(b){var c,d,e,f;if(b<a.length){f=a[b];for(d=0,e=f.length;d<e;d++)c=f[d],c();return setTimeout(function(){return o(b+1)},0)}};return o(0)},m=null,a.eventModelChange=function(){m!=null&&clearTimeout(m);return m=setTimeout(function(){a.selfRender();return m=null},0)},f=function(b,d,e,f){var h,i,j,l;l={},i=c("<span style='display: inline-block'></span>"),l.$el=i,j=e.getItem(f),i.text(j.text[0]),i.addClass(j.type.join(" ")),j.css!=null&&!/^\s*$/.test(j.css)&&i.attr("style",j.css[0]),h=j.text[0].replace(/\s+/g," "),h===" "?l.charWidth=0:l.charWidth=h.length;if(l.charWidth===0)return null;k[g]==null&&(k[g]=[]),k[g].push(l),l.line=g,l.positioned=!1,l.setScale=function(a){},l.afterLayout=function(){return l.width=l.$el.width()/a.getScale()},l.remove=function(){var a;i.remove();return k[l.line]=function(){var b,c,d,e;d=k[l.line],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a!==l&&e.push(a);return e}()},l.update=function(a){return i.text(a.text[0])};return l},e=function(b,d,e,f){var h,i,j,l,m,n,o,p,q;n={},i=c("<span style='display: inline-block'></span>"),n.$el=i,j=e.getItem(f),i.text(j.text[0]),i.addClass(j.type.join(" ")),j.css!=null&&/vertical-align: sub;/.test(j.css[0])?m=g+.3:j.css!=null&&/vertical-align: super;/.test(j.css[0])?m=g-.3:m=g,k[m]==null&&(k[m]=[]),k[m].push(n),l=(o=k[g])!=null?o[((p=k[g])!=null?p.length:void 0)-1]:void 0,n.positioned=g!==m&&((q=k[g])!=null?q.length:void 0)>0,h=j.text[0].replace(/\s+/g," "),h===" "?n.charWidth=0:n.charWidth=h.length,n.line=m,n.setScale=function(){},n.afterLayout=function(){var b,d,e,f,g,h,i,j,k,m,o,p,q;j=a.getWidth()/10,i=n.$el.parent().offset().left,n.width=n.$el.width()/a.getScale(),n.$el.css({width:Math.ceil(n.width*a.getScale())+"px"});if(l!=null){g=n.$el.offset(),l.$el.hasClass("DeletionAnnotation")?e=l.$el.offset().left+l.$el.outerWidth(!1)/2:e=l.$el.offset().left+l.$el.outerWidth(!1),f=g.left+n.$el.outerWidth(!1)/2,h=e-f,m=n.$el.prev(),b=0,p=0,m!=null&&m.size()>0&&(k=m.offset(),b=m.offset().left+m.outerWidth(!1)-i,p=k.left+m.outerWidth(!1)-g.left,p=parseInt(m.css("left"),10)||0,p>h&&(h=p)),h>=0&&h+(g.left-i)+b+n.$el.outerWidth(!1)>j&&(h=j-(g.left-i)-b-n.$el.outerWidth(!1)),h<0&&(m!=null&&m.size()>0?(h=-h,o=n.$el.prevAll(),d=0,o.each(function(a,b){return d+=parseInt(c(b).css("left"),10)||0}),m.size()>0&&(d-=m.offset().left-i+m.outerWidth(!1)),d>h?(q=0,o.each(function(a,b){var e,f;e=parseInt(c(b).css("left"),10)||0;if(d>0){f=Math.floor(e*(h-q)/d),c(b).css("left",e-f-q+"px"),q+=f;return d-=e}}),h=-h):(o.each(function(a,b){return c(b).css("left","0px")}),h=0)):h=0);if(h>0){m.size()>0&&h<parseInt(m.css("left"),10)&&(h=parseInt(m.css("left"),10)),n.$el.css({position:"relative",left:h+"px"}),n.left=h/a.getScale();return n.setScale=function(a){return n.$el.css({left:Math.floor(n.left*a)+"px",width:Math.ceil(n.width*a)+"px"})}}}},n.remove=function(){var a;i.remove();return k[n.line]=function(){var b,c,d,e;d=k[n.line],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a!==n&&e.push(a);return e}()},n.update=function(a){return i.text(a.text[0])};return n},h={},a.addLens=function(a,b){return h[a]=b},a.getLens=function(d){var e,f,g,i,j,k,l,m;e=a.dataView.getItem(d),g=[],m=e.type;for(i=0,k=m.length;i<k;i++)f=m[i],c.isArray(f)?g=g.concat(f):g.push(f);if(b.call(g,"AdditionAnnotation")>=0)return{render:h.AdditionAnnotation};for(j=0,l=g.length;j<l;j++){f=g[j];if(f!=="LineAnnotation"&&h[f]!=null)return{render:h[f]}}return{render:h.LineAnnotation}},a.hasLens=function(a){return h[a]!=null},a.addLens("AdditionAnnotation",e),a.addLens("DeletionAnnotation",f),a.addLens("SearchAnnotation",f),a.addLens("LineAnnotation",f),a.addLens("Text",function(){});return a.addLens("LineBreak",function(a,b,c,d){var e,f,h;e=c.getItem(d),((f=e.align)!=null?f.length:void 0)>0&&(i[g]=e.align[0]),((h=e.indent)!=null?h.length:void 0)>0&&(j[g]=Math.floor(e.indent[0])||0),g+=1;return null})}]))}}),e.namespace("Zone",function(f){return f.initInstance=function(){var f,g;f=1<=arguments.length?a.call(arguments,0):[];return(g=d.Presentation).initInstance.apply(g,["SGA.Reader.Presentation.Zone"].concat(a.call(f),[function(a,f){var g,h,i,j;i=a.options,j=i.svgRoot,h=a.options.application(),a.setHeight(i.height),a.setWidth(i.width),a.setX(i.x),a.setY(i.y),a.setScale(i.scale),c(f).css({overflow:"hidden"}),typeof a.onDestroy=="function"&&a.onDestroy(a.events.onScaleChange.addListener(function(b){return a.visitRenderings(function(a,c){typeof c.setScale=="function"&&c.setScale(b);return!0})})),g=a.dataView.prepare(["!target"]),a.addLens("ContentAnnotation",function(d,e,g,h){var j,k,l,m,n,o,p,q,r,s,t,u,v;if(b.call(i.types||[],"Text")>=0){m={},k=g.getItem(h),o=c("<div></div>"),q=((s=k.x)!=null?s[0]:void 0)!=null?k.x[0]:0,r=((t=k.y)!=null?t[0]:void 0)!=null?k.y[0]:0,p=((u=k.width)!=null?u[0]:void 0)!=null?k.width[0]:i.width-q,j=((v=k.height)!=null?v[0]:void 0)!=null?k.height[0]:i.height-r,c(o).css({position:"absolute",left:Math.floor(16+q*a.getScale())+"px",top:Math.floor(r*a.getScale())+"px",width:Math.floor(p*a.getScale())+"px",height:Math.floor(j*a.getScale())+"px"}),f.append(o),l=c("<div></div>"),f.append(l),n=c("<div></div>"),c(n).addClass("text-content"),c(l).css({overflow:"auto",height:Math.floor(j*a.getScale())+"px",width:Math.floor(p*a.getScale())+"px"}),l.append(n),n.text(k.text[0]),m.getHeight=function(){return c(o).height()*10},m.getY=function(){return c(o).position().top*10},m.update=function(a){return n.text(a.text[0])},m.remove=function(){return n.remove()},m.setScale=function(b){c(o).css({left:Math.floor(16+q*b)+"px",top:Math.floor(r*b)+"px",width:Math.floor(p*b)+"px",height:Math.floor(j*b)+"px"});return c(l).css({height:Math.floor(j*a.getScale())+"px",width:Math.floor(p*a.getScale())+"px"})};return m}}),a.addLens("TextContentZone",function(g,j,k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;if(b.call(i.types||[],"Text")>=0){t={},h=i.application(),E=h.imageControls.getZoom(),n=k.getItem(l),x=c("<div></div>"),x.css({overflow:"auto",position:"absolute"}),f.append(x),u=c("<div></div>"),c(u).addClass("text-content"),c(u).attr("id",l),c(u).css({"white-space":"nowrap"}),x.append(u),z=function(a){},h=i.application(),c(".marquee").remove(),v=1,o=c("<div class='marquee'></div>"),c(f).append(o),o.css({"border-color":"navy","background-color":"yellow","border-width":v,opacity:"0.1","border-opacity":"0.9",width:i.width*i.scale,height:i.height*i.scale,position:"absolute","z-index":0,top:0,left:16}),A=100,q=0,r=0,s=Math.floor(a.getWidth()*A*a.getScale()/100,10),p=Math.floor(a.getHeight()*A*a.getScale()/100,10),z=function(b){var d;if(h.imageControls.getMaxZoom()>0){d=Math.floor(a.getWidth()*a.getScale()/Math.pow(2,b)),A=Math.min(100,d*100/c(f).width()),s=Math.floor(a.getWidth()*A*a.getScale()/100,10),p=Math.floor(a.getHeight()*A*a.getScale()/100,10),o.css({width:q<0?s+q:s+q>c(f).width()?c(f).width()-q:s,height:r<0?p+r:p+r>c(f).height()?c(f).height()-r:p});return h.imageControls.getZoom()>h.imageControls.getMaxZoom()-1?c(o).css("opacity","0"):c(o).css("opacity","0.1")}},typeof a.onDestroy=="function"&&a.onDestroy(h.imageControls.events.onZoomChange.addListener(z)),typeof a.onDestroy=="function"&&a.onDestroy(h.imageControls.events.onImgPositionChange.addListener(function(b){q=Math.floor(-b.topLeft.x*a.getScale()),r=Math.floor(-b.topLeft.y*a.getScale());return o.css({left:16+Math.max(0,q),top:Math.max(0,r),width:q<0?s+q:s+q>c(f).width()?c(f).width()-q:s,height:r<0?p+r:p+r>c(f).height()?c(f).height()-r:p})})),c(".marquee").hide(),typeof a.onDestroy=="function"&&a.onDestroy((F=h.imageControls)!=null?F.events.onActiveChange.addListener(function(a){return a?c(".marquee").show():c(".marquee").hide()}):void 0),a.events.onScaleChange.addListener(function(a){return z(h.imageControls.getZoom())}),y=d.Data.SubSet.initInstance({dataStore:k,expressions:["!target"]}),C=((G=n.x)!=null?G[0]:void 0)!=null?n.x[0]:0,D=((H=n.y)!=null?H[0]:void 0)!=null?n.y[0]:0,B=((I=n.width)!=null?I[0]:void 0)!=null?n.width[0]:i.width-C,m=((J=n.height)!=null?J[0]:void 0)!=null?n.height[0]:i.height-D,c(x).css({left:Math.floor(16+C*a.getScale())+"px",top:Math.floor(D*a.getScale())+"px",width:Math.floor(B*a.getScale())+"px",height:Math.floor(m*a.getScale())+"px"}),w=e.TextContent.initInstance(u,{types:i.types,dataView:y,application:i.application,height:m,width:B,x:C,y:D,scale:a.getScale(),inHTML:!0}),y.setKey(l),t.getHeight=w.getHeight,t.getY=w.getY,t._destroy=function(){w._destroy!=null&&w._destroy();if(y._destroy!=null)return y._destroy()},t.remove=function(){return c(x).empty()},t.setScale=function(a){c(x).css({left:Math.floor(16+C*a)+"px",top:Math.floor(D*a)+"px",width:Math.floor(B*a)+"px",height:Math.floor(m*a)+"px"});return w.setScale(a)},t.update=function(b){var d,e,f,g;C=((d=b.x)!=null?d[0]:void 0)!=null?b.x[0]:0,D=((e=b.y)!=null?e[0]:void 0)!=null?b.y[0]:0,B=((f=b.width)!=null?f[0]:void 0)!=null?b.width[0]:i.width-C,m=((g=b.height)!=null?g[0]:void 0)!=null?b.height[0]:i.height-D,a.setHeight(m);return c(x).css({left:Math.floor(16+C*a.getScale())+"px",top:Math.floor(D*a.getScale())+"px",width:Math.floor(B*a.getScale())+"px",height:Math.floor(m*a.getScale())+"px"})};return t}}),a.addLens("Image",function(d,e,f,g){var h,j,k,l,m,n,o,p;if(b.call(i.types||[],"Image")>=0){m={},k=f.getItem(g),j=null,h=0,p=0,o=0,n=0,l=function(b){var e,f,g,k,l,m;if(((f=b.image)!=null?f[0]:void 0)!=null){o=((g=b.x)!=null?g[0]:void 0)!=null?b.x[0]:0,p=((k=b.y)!=null?k[0]:void 0)!=null?b.y[0]:0,n=((l=b.width)!=null?l[0]:void 0)!=null?b.width[0]:i.width-o,h=((m=b.height)!=null?m[0]:void 0)!=null?b.height[0]:i.height-p,e=a.getScale(),j!=null&&j.remove(),j=c("<img></img>"),c(d).append(j),j.attr({height:Math.floor(h*e),width:Math.floor(n*e),src:b.image[0],border:"none"});return j.css({position:"absolute",top:Math.floor(p*e),left:Math.floor(o*e)})}},l(k),m.setScale=function(a){if(j!=null){j.attr({height:Math.floor(h*a),width:Math.floor(n*a)});return j.css({top:Math.floor(p*a),left:Math.floor(o*a)})}},m.getHeight=function(){return h},m.getY=function(){return p},m.update=l,m.remove=function(){if(j!=null){j.remove();return j=null}};return m}});return a.addLens("ImageViewer",function(e,g,j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(b.call(i.types||[],"Image")>=0){w={},p=256,t=j.getItem(k),z=((C=t.x)!=null?C[0]:void 0)!=null?t.x[0]:0,A=((D=t.y)!=null?D[0]:void 0)!=null?t.y[0]:0,y=((E=t.width)!=null?E[0]:void 0)!=null?t.width[0]:i.width-z,q=((F=t.height)!=null?F[0]:void 0)!=null?t.height[0]:i.height-A,o=c(f).width()||1,m=c(f).height()||1,n=a.getScale(),s=n,c(e).css({overflow:"hidden",position:"absolute",top:0,left:"16px"}),r=c("<div></div>"),c(e).append(r),h.imageControls.setActive(!0),l=t.url[0],x=l.replace(/http:\/\/tiles2\.bodleian\.ox\.ac\.uk:8080\//,"/"),w.update=function(a){},B=null,w.getZoom=function(){return B},w.setZoom=function(a){},w.setScale=function(a){},w.getScale=function(){return n},w.getX=function(){},w.setX=function(a){},w.getY=function(){},w.setY=function(a){},u=0,v=0,w.setOffsetX=function(a){},w.setOffsetY=function(a){},w.getOffsetX=function(){return u},w.getOffsetY=function(){return v},w.remove=function(){return c(r).empty()},c.ajax({url:x+"&svc_id=info:lanl-repo/svc/getMetadata",success:function(b){var g,i,j,k,t,x,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;F=Math.floor(b.width)||1,E=Math.floor(b.height)||1,s=y/F,W=Math.floor(b.levels),o=c(f).width()||1,m=c(f).height()||1,U=Math.floor(F*n*Math.pow(2,B)/p),V=Math.floor(E*n*Math.pow(2,B)/p),C=!1,N=0,O=0,P=u,Q=v,u=0,v=0,g=0,G=function(){o=c(f).width()||1;if(a.getScale!=null){g=Math.max(0,Math.ceil(-Math.log(a.getScale()*s)/Math.log(2))),h.imageControls.setMinZoom(0);return h.imageControls.setMaxZoom(W-g)}},T=function(a){var b;a(),b=Math.ceil(B+g);return c(r).find("img").each(function(a,d){var e,f;e=c(d),z=e.data("x"),A=e.data("y"),f=e.data("z");return f!==b?e.css({"z-index":-10}):e.css({"z-index":0})})},Y=function(a){var b;b=function(a){return a()},a<0&&(a=0),a>W-g&&(a=W-g);if(a!==B){B!=null&&Math.ceil(a)!==Math.ceil(B)&&(b=T),B=a;return b(I)}},w.setZoom=function(a){if(a!==B){Y(a);return h.imageControls.setZoom(a)}},w.setScale=function(a){var b,d;n=a,c(e).css({width:F*n*s,height:E*n*s}),b=g,G(),b!==g?(B=B-g+b,B>W-g&&(B=W-g),B<0&&(B=0),d=T):d=function(a){return a()};return d(I)},typeof a.onDestroy=="function"&&a.onDestroy(h.imageControls.events.onZoomChange.addListener(w.setZoom)),S=function(){return h.imageControls.setImgPosition({topLeft:{x:u*s,y:v*s}})},G(),R=[];for(t=X=0;0<=W?X<=W:X>=W;t=0<=W?++X:--X)R[t]=[];x=function(a,b,c){var d;d=Math.pow(2,W-c)*p;return[l,"svc_id=info:lanl-repo/svc/getRegion","svc_val_fmt=info:ofi/fmt:kev:mtx:jpeg2000","svc.format=image/jpeg","svc.level="+c,"svc.region="+b*d+","+a*d+","+p+","+p].join("&")},K=function(){return D(u,v)},i=function(){return Math.pow(2,W-Math.ceil(B+g))*p},j=function(){return Math.floor(Math.pow(2,B)*n*s*i())},L=function(a,b){var c,d,e,f;e=j(),f=b*e,d=a*e,c=K();return{top:f+c.top,left:d+c.left}},D=function(a,b){return{left:a*n*s*Math.pow(2,B),top:b*n*s*Math.pow(2,B)}},J=function(a,b){return{left:a/n/s/Math.pow(2,B),top:b/n/s/Math.pow(2,B)}},k=function(){var a,b;a=!1;if(B===0){if(u!==0||v!==0)a=!0;u=0,v=0}else b=J(o,m),u>0&&(a=!0,u=0),v>0&&(a=!0,v=0),u<-F+b.left&&(a=!0,u=-F+b.left),v<-E+b.top&&(a=!0,v=-E+b.top);return a},M=function(a,b){var c,d,e;e=j(),c=i(),(a+1)*c>F?y=F-a*c:y=c,(b+1)*c>E?q=E-b*c:q=c,d=e/c;return{width:Math.max(0,y*d),height:Math.max(0,q*d)}},H=function(a){var b,e,f,h,i,j,k,l;h=Math.ceil(B+g),f=L(a.x,a.y),b=M(a.x,a.y);if(b.height!==0&&b.width!==0){((k=R[h])!=null?(l=k[a.x])!=null?l[a.y]:void 0:void 0)!=null&&(e=R[h][a.x][a.y]);if(f.left+b.width<0||f.left>o||f.top+b.height<0||f.top>m){e!=null&&e.hide();return}e!=null?e.show():(e=c("<img></img>"),c(r).append(e),e.attr({"data-x":a.x,"data-y":a.y,"data-z":h,border:"none",src:x(a.x,a.y,h)}),R[h]==null&&(R[h]=[]),(i=R[h])[j=a.x]==null&&(i[j]=[]),R[h][a.x][a.y]=e,function(a){a.bind("mousedown",function(a){if(!C){a.preventDefault(),N=null,O=null,P=u,Q=v,C=!0;return d.mouse.capture(function(a){var b,c;b=this;switch(a){case"mousemove":if(N==null||O==null)N=b.pageX,O=b.pageY;c=J(N-b.pageX,O-b.pageY),u=P-c.left,v=Q-c.top,I();return S();case"mouseup":C=!1;return d.mouse.uncapture()}})}});return a.bind("mousewheel DOMMouseScroll MozMousePixelScroll",function(b){var d,e,f;b.preventDefault(),C=!1,z=b.originalEvent.offsetX+parseInt(c(a).css("left"),10),A=b.originalEvent.offsetY+parseInt(c(a).css("top"),10),h=w.getZoom(),d=u,e=v,f=J(z,A),d-=f.left,e-=f.top;if(h>=0&&h<=W-g){w.setZoom((h+1)*(1+b.originalEvent.wheelDeltaY/500)-1);if(c(a).data("z")===Math.ceil(B+g)){f=J(z,A),d+=f.left,e+=f.top,u=d,v=e;return I()}}})}(e));return e.css({position:"absolute",top:f.top,left:f.left,width:b.width,height:b.height})}},I=function(){var a,b,d,e;o=c(f).width()||1,m=c(f).height()||1,k()&&S(),b=j(),U=Math.floor(F*n*s*Math.pow(2,B)/b),V=Math.floor(E*n*s*Math.pow(2,B)/b),e=[];for(a=d=0;0<=V?d<=V:d>=V;a=0<=V?++d:--d)e.push(function(){var c,d;d=[];for(t=c=0;0<=U?c<=U:c>=U;t=0<=U?++c:--c)d.push(H({x:t,y:a,tileSize:b}));return d}());return e},w.setOffsetX=function(a){u=a,I();return S()},w.setOffsetY=function(a){v=a,I();return S()},w.addoffsetX=function(a){return w.setOffsetX(u+a)},w.addoffsetY=function(a){return w.setOffsetY(v+a)};return w.setZoom(0)}});return w}})}]))}});return e.namespace("Canvas",function(b){return b.initInstance=function(){var b,e;b=1<=arguments.length?a.call(arguments,0):[];return(e=d.Presentation).initInstance.apply(e,["SGA.Reader.Presentation.Canvas"].concat(a.call(b),[function(a,b){var e,f,g,h,i,j,k,l,m,n,o;l=a.options,g=a.dataView.prepare(["!target"]),b.css({overflow:"hidden"}),o=c("<div></div>"),b.append(o),c(o).height(Math.floor(c(b).width()*4/3)),c(o).css({"background-color":"white","z-index":0}),j=null,i=null,h=150,e=null,f=Math.floor(c(b).width()*20/20),c(b).height(Math.floor(c(b).width()*4/3)),n=function(){f=Math.floor(c(b).width()*20/20,10),j!=null&&j>0&&a.setScale(f/j);if(i!=null&&i>0)return c(b).height(e=Math.floor(i*a.getScale()))},d.events.onWindowResize.addListener(n),c(o).css({border:"1px solid grey","background-color":"white"}),a.events.onScaleChange.addListener(function(a){j!=null&&i!=null&&(e=Math.floor(i*a)),c(o).css({"font-size":Math.floor(h*a*10)/10+"px","line-height":Math.floor(h*a*11.5)/10+"px",height:e,width:f}),typeof m!="undefined"&&m!==null&&m.setScale(a);return c(b).trigger("sizeChange",[{w:c(b).width(),h:c(b).height()}])}),k=d.Data.SubSet.initInstance({dataStore:l.dataView,expressions:["!target"],key:null}),m=null,c(b).on("resetPres",function(){n(),m!=null&&(m.hide!=null&&m.hide(),m._destroy!=null&&m._destroy()),c(o).empty();return m=SGA.Reader.Presentation.Zone.initInstance(o,{types:l.types,dataView:k,application:l.application,height:i,width:j,scale:f/j})});return a.events.onCanvasChange.addListener(function(b){var d,e,g;k.setKey(b),d=k.getItem(b),j=((e=d.width)!=null?e[0]:void 0)||1,i=((g=d.height)!=null?g[0]:void 0)||1,n(),m!=null&&(m.hide!=null&&m.hide(),m._destroy!=null&&m._destroy()),c(o).empty(),m=SGA.Reader.Presentation.Zone.initInstance(o,{types:l.types,dataView:k,application:l.application,height:i,width:j,scale:f/j}),a.setHeight(i);return m.events.onHeightChange.addListener(a.setHeight)})}]))}})}),e.namespace("Data",function(e){e.namespace("StyleStore",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,a.call(b).concat([function(a){var b,c,d;c=a.options,b={},d=new RegExp("(?:\\.(\\S+)\\s*\\{\\s*([^}]*)\\s*\\})","mg"),a.addStyles=function(a,c){var e,f;if(b[a]==null){b[a]={},e=d.exec(c),f=[];while((e!=null?e.index:void 0)!=null)b[a][e[1]]=e[2],f.push(e=d.exec(c));return f}};return a.getStylesForClass=function(a,c){var d;return((d=b[a])!=null?d[c]:void 0)!=null?b[a][c]:""}}]))}}),e.namespace("TextStore",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,a.call(b).concat([function(a){var b,d,e,f;e=a.options,b={},d={},f={},a.addFile=function(a){var e,f,g,h;c.isArray(a)||(a=[a]),h=[];for(f=0,g=a.length;f<g;f++)e=a[f],h.push(function(a){if(a!=null&&b[a]==null&&d[a]==null){d[a]=[];return c.ajax({url:a,type:"GET",processData:!1,success:function(c){var e,f,g,h,i;e=c.documentElement.textContent,b[a]=e,i=d[a];for(g=0,h=i.length;g<h;g++)f=i[g],f(e);return delete d[a]}})}}(e));return h};return a.withFile=function(c,e){if(b[c]!=null)return e(b[c]);if(d[c]!=null)return d[c].push(e);a.addFile(c);return d[c].push(e)}}]))}});return e.namespace("Manifest",function(e){var f,g;f={"http://dms.stanford.edu/ns/":"sc","http://www.shared-canvas.org/ns/":"sc","http://www.w3.org/2000/01/rdf-schema#":"rdfs","http://www.w3.org/1999/02/22-rdf-syntax-ns#":"rdf","http://www.w3.org/2003/12/exif/ns#":"exif","http://purl.org/dc/elements/1.1/":"dc","http://www.w3.org/ns/openannotation/core/":"oa","http://www.openannotation.org/ns/":"oa","http://www.w3.org/ns/openannotation/extension/":"oax","http://www.openarchives.org/ore/terms/":"ore","http://www.shelleygodwinarchive.org/ns/1#":"sga","http://www.shelleygodwinarchive.org/ns1#":"sga","http://www.w3.org/2011/content#":"cnt","http://purl.org/dc/dcmitype/":"dctypes"},g={"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"item","http://www.w3.org/ns/openannotation/core/hasMotivation":"item"};return e.initInstance=function(){var e;e=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Data.Manifest"].concat(a.call(e),[function(a){var e,h,i,j,k,l,m,n,o;o=a.options,e=d.Data.Store.initInstance(),a.size=function(){return e.size()},k=d.Data.Importer.RDF_JSON.initInstance(e,f,g),n=[],j=function(d,e){{if(b.call(n,d)<0){n.push(d),a.addItemsToProcess(1);return c.ajax({url:d,type:"GET",contentType:"application/rdf+json",processData:!1,dataType:"json",success:function(b){a.addItemsProcessed(1);return a.importJSON(b,e)},error:function(b){a.addItemsProcessed(1);throw new Error("Could not load the manifest")}})}e()}},a.importJSON=function(a,b){var c;c=d.initSynchronizer(b),c.increment(),k["import"](a,function(a){var b,f;b=d.Data.Set.initInstance(a),f=e.getObjectsUnion(b,"oreisDescribedBy"),f.visit(function(a){c.increment();return j(a,c.decrement)});return c.decrement()});return c.done()},m=function(a){c.isArray(a)||(a=[a]),g=d.Data.Set.initInstance(a);return e.getSubjectsUnion(g,"type").items()},l=function(a){var b,f,g,h,i,j,k,l;c.isArray(a)||(a=[a]),f=d.Data.Set.initInstance(a),i=e.getSubjectsUnion(f,"oahasSource"),h=e.getSubjectsUnion(f,"oahasTarget"),g=e.getSubjectsUnion(i,"oahasTarget"),k=e.getObjectsUnion(g,"oahasBody"),l=e.getObjectsUnion(k,"oahasSource"),j=e.getSubjectsUnion(l,"oahasSource"),b=e.getSubjectsUnion(j,"oahasTarget").items();return b.concat(h.items(),g.items())},h=function(){var a;g=d.Data.Set.initInstance(["sgaSearchAnnotation"]),a=e.getSubjectsUnion(g,"type").items();return e.removeItems(a)},i=function(){var a,b,f,h,i,j,k;g=d.Data.Set.initInstance(["sgaSearchAnnotation"]),f=e.getSubjectsUnion(g,"type"),i=e.getObjectsUnion(f,"oahasTarget"),k=e.getObjectsUnion(i,"oahasSource"),h=e.getSubjectsUnion(k,"oahasSource"),a=e.getSubjectsUnion(h,"oahasBody"),j=e.getObjectsUnion(a,"oahasTarget"),b=e.getObjectsUnion(j,"oahasSource");return c.unique(b.items())},a.getCanvases=function(){return m("scCanvas")},a.getZones=function(){return m("scZone")},a.getSequences=function(){return m("scSequence")},a.getAnnotations=function(){return m("oaAnnotation")},a.getRanges=function(){return m("scRange")},a.getLayers=function(){return m("scLayer")},a.getManifests=function(){return m("scManifest")},a.getAnnotationsForCanvas=l,a.flushSearchResults=h,a.getSearchResultCanvases=i,a.getItem=e.getItem,a.contains=e.contains;return a.importFromURL=function(a,b){return j(a,function(){if(b!=null)return b()})}}]))}})}),e.namespace("Component",function(b){b.namespace("ProgressBar",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.ProgressBar"].concat(a.call(b),[function(a,b){a.events.onNumeratorChange.addListener(function(d){var e;e=parseInt(100*d/a.getDenominator(),10),e>100&&(e=100);return c(b).find(".bar").css("width",e+"%")}),a.events.onDenominatorChange.addListener(function(d){var e;e=parseInt(100*a.getNumerator()/d,10),e>100&&(e=100);return c(b).find(".bar").css("width",e+"%")}),a.show=function(){return c(b).show()};return a.hide=function(){return c(b).hide()}}]))}}),b.namespace("Spinner",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.Spinner"].concat(a.call(b),[function(a,b){var d,e;d=c(window).width(),e=c(window).height(),d<1&&(d=e),d-=c(b).width(),e-=c(b).height(),d<1&&(d=e*2),c(b).css({position:"absolute","z-index":1e4,top:"50%",left:"50%"}),a.show=function(){return c(b).show()};return a.hide=function(){return c(b).hide()}}]))}}),b.namespace("SequenceSelector",function(b){return b.initInstance=function(){var b,e;b=1<=arguments.length?a.call(arguments,0):[];return(e=d.Presentation).initInstance.apply(e,["SGA.Reader.Component.SequenceSelector"].concat(a.call(b),[function(a,b){var d;d=a.options;return a.addLens("Sequence",function(b,d,e,f){var g,h,i,j;a.setSequence(f);if(c(b).is("select")){i={},h=e.getItem(f),g=c("<option></option>"),g.attr({value:f}),g.text((j=h.label)!=null?j[0]:void 0),c(b).append(g),c(b).change(function(){return a.setSequence(c(b).val())}),a.events.onSequenceChange.addListener(function(a){return c(b).val(a)});return a.finishDisplayUpdate=function(){return a.setSequence(c(b).val())}}})}]))}}),b.namespace("Slider",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.Slider"].concat(a.call(b),[function(a,b){var d;d=a.options,c(".canvas").on("searchResultsChange",function(d,e){var f,g,h,i,j,k,l,m,n,o,p,q;f=c(b),c(".res").remove(),h=a.getMax();try{q=[];for(o=0,p=e.length;o<p;o++)i=e[o],i=i+1,k=f.height()/(h+1),j=(h+1)/100,m=f.slider("option","min"),l=f.slider("option","max"),n=100-(i-m)/(l-m)*100,g=j/2,q.push(f.append("<div style='bottom:"+(n+g)+"%; height:"+k+"px' class='res ui-slider-range ui-widget-header ui-corner-all'> </div>"));return q}catch(r){d=r;return console.log("Unable to update slider with search results")}}),a.events.onMaxChange.addListener(function(e){var f,g;try{c(b).data("slider")?c(b).slider({max:e}):(g=e,c(b).slider({orientation:"vertical",range:"min",min:a.getMin(),max:g,value:g,step:1,slide:function(a,b){if(d.getLabel!=null)return c(b.handle).text(d.getLabel(g-b.value))},stop:function(b,c){0;return a.setValue(g-c.value)}}),d.getLabel!=null&&c(b).find("a").text(d.getLabel(0)),c(".canvas").on("sizeChange",function(a,d){var e;e=c(b),e.height(d.h);return c(".canvas").unbind("sizeChange")}));if(a.getValue()!=null&&parseInt(a.getValue())!==NaN){c.bbq.pushState({n:a.getValue()+1});return c(b).slider({value:g-a.getValue()})}}catch(h){f=h;return console.log("Unable to update maximum value of slider")}}),a.events.onMinChange.addListener(function(a){var d;try{if(c(b).data("slider"))return c(b).slider({min:a})}catch(e){d=e;return console.log("Unable to update minimum value of slider")}});return a.events.onValueChange.addListener(function(e){var f;try{c(b).data("slider")&&c(b).slider({value:a.getMax()-e}),d.getLabel!=null&&c(b).find("a").text(d.getLabel(e));if(a.getValue()!=null&&parseInt(a.getValue())!==NaN)return c.bbq.pushState({n:a.getValue()+1})}catch(g){f=g;return console.log("Unable to update value of slider")}})}]))}}),b.namespace("PagerControls",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance
.apply(d,["SGA.Reader.Component.PagerControls"].concat(a.call(b),[function(a,b){var d,e,f,g,h;c(window).bind("hashchange",function(b){var d;d=c.bbq.getState("n");if(d!=null&&parseInt(d)!==NaN)return a.setValue(d-1)}),d=c(b).find("#first-page"),g=c(b).find("#prev-page"),f=c(b).find("#next-page"),e=c(b).find("#last-page"),a.events.onMinChange.addListener(function(b){if(b<a.getValue()){d.removeClass("disabled");return g.removeClass("disabled")}d.addClass("disabled");return g.addClass("disabled")}),a.events.onMaxChange.addListener(function(b){if(b>a.getValue()){f.removeClass("disabled");return e.removeClass("disabled")}f.addClass("disabled");return e.addClass("disabled")}),a.events.onValueChange.addListener(function(b){b>a.getMin()?(d.removeClass("disabled"),g.removeClass("disabled")):(d.addClass("disabled"),g.addClass("disabled"));if(b<a.getMax()){f.removeClass("disabled");return e.removeClass("disabled")}f.addClass("disabled");return e.addClass("disabled")}),h=function(){if(a.getValue()!=null&&parseInt(a.getValue())!==NaN)return c.bbq.pushState({n:a.getValue()+1})},c(g).click(function(b){b.preventDefault(),a.addValue(-1);return h()}),c(f).click(function(b){b.preventDefault(),a.addValue(1);return h()}),c(d).click(function(b){b.preventDefault(),a.setValue(a.getMin());return h()});return c(e).click(function(b){b.preventDefault(),a.setValue(a.getMax());return h()})}]))}}),b.namespace("ImageControls",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.ImageControls"].concat(a.call(b),[function(a,b){var d,e,f,g;g=c(b).find("#zoom-reset"),d=c(b).find("#zoom-in"),f=c(b).find("#zoom-out"),e=c(b).find("#marquee-sh"),c(g).click(function(b){b.preventDefault(),a.setZoom(a.getMinZoom());return a.setImgPosition({topLeft:{x:0,y:0},bottomRight:{x:0,y:0}})}),c(d).click(function(b){var c;b.preventDefault(),c=a.getZoom();if(Math.floor(c+1<=a.getMaxZoom()))return a.setZoom(Math.floor(c+1))}),c(f).click(function(b){var c,d;b.preventDefault(),d=a.getZoom(),c=a.getMinZoom();if(Math.floor(d-1>c))return a.setZoom(Math.floor(d-1));if(Math.floor(d-1===Math.floor(c)))return a.setZoom(c)});return c(e).click(function(a){var b;a.preventDefault(),b=c(".marquee");return b.each(function(a,b){b=c(b);return b.css("display")!=="none"?b.hide():b.show()})})}]))}}),b.namespace("SearchBox",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.SearchBox"].concat(a.call(b),[function(a,d){var e,f,g;a.events.onQueryChange.addListener(function(a){a=a.replace(/\=/g,":"),a=a.replace(/\&/g,"|");return c.bbq.pushState({s:a})}),e=b[0],a.setServiceURL(d),f=c("#search-btn"),g=c(e).closest("form"),f!=null&&f.click(function(){return g.submit()});return g.submit(function(b){var d,f,g,h,i,j,k;b.preventDefault(),g=c("#limit-search").find("input:checked"),f="";if(g.length===0)f="text";else for(h=j=0,k=g.length;j<k;h=++j)d=g[h],f+=c(d).val(),h+1!==g.length&&(f+=",");i=c(e).find("input").val(),i.match("^s*$")||a.setQuery("f="+f+"&q="+i);return!1})}]))}}),b.namespace("ModeLayers",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.ModeLayers"].concat(a.call(b),[function(a,b){var e,f,g,h,i,j,k;e=null,j=null,k=null,h=[],f=function(){var b,c,e,f,g,i,j,k;c=a.options.dataView,e=d.Data.Set.initInstance(["LayerAnno"]),j=c.getSubjectsUnion(e,"type").items(),k=[];for(g=0,i=j.length;g<i;g++)f=j[g],b=c.getItem(f),k.push(h.push(b));return k},i=function(){a.options.getMode()==="xml"?(c(b).html(k),prettyPrint()):c(b).html(j);return c(b).show()},g=function(){return c(b).hide()},a.options.dataView.events.onAfterLoading.addListener(function(a){return f()}),a.options.pagerEvt.addListener(function(d){var e,f,g,i,l;f=f,c(b).height(c(".canvas").height()),l=[];for(g=0,i=h.length;g<i;g++)e=h[g],e.canvas[0]===d?e.motivation[0]==="http://www.shelleygodwinarchive.org/ns1#reading"?l.push(c.get(e.body,function(d){var e,f,g,h,i;e=c.parseHTML(d),i=[];for(g=0,h=e.length;g<h;g++)f=e[g],c(f).is("div")?(j=f,a.options.getMode()==="reading"?i.push(c(b).html(j)):i.push(void 0)):i.push(void 0);return i})):e.motivation[0]==="http://www.shelleygodwinarchive.org/ns1#source"?l.push(c.get(e.body,function(d){var e,f,g;f=d.getElementsByTagName("surface"),e=new XMLSerializer,g=e.serializeToString(f[0]),g=g.replace(/\&/g,"&amp;"),g=g.replace(/%/g,"&#37;"),g=g.replace(/</g,"&lt;"),g=g.replace(/>/g,"&gt;"),k="<pre class='prettyprint'><code class='language-xml'>"+g+"</code></pre>";if(a.options.getMode()==="xml"){c(b).html(k);return prettyPrint()}})):l.push(void 0):l.push(void 0);return l});return a.options.onModeChange.addListener(function(a){switch(a){case"reading":c(b).removeClass("xml");return i();case"xml":c(b).addClass("xml");return i();default:return g()}})}]))}}),b.namespace("ModeControls",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.ModeControls"].concat(a.call(b),[function(a,b){var d,e,f,g,h,i,j,k;f=a.options,j=null,h=function(){var b,d;d=c("*[data-types=Image]").parent(),b=/(col-[^-]+?-)(\d+)/g.exec(c("*[data-types=Image]").parent()[0].className),d[0].className=b[1]+parseInt(b[2])/2,j.insertAfter(d),c("*[data-types=Image]").trigger("resetPres"),j=null;return a.setMode("normal")},e=SGA.Reader.Controller.ModeSelector.initInstance(),g=e.bind("#mode-rdg",{mode:"reading"}),k=e.bind("#mode-xml",{mode:"xml"}),i=e.bind("#mode-std",{mode:"normal"}),d=e.bind("#img-only",{mode:"imgOnly"}),g.events.onModeSelect.addListener(a.setMode),k.events.onModeSelect.addListener(a.setMode),i.events.onModeSelect.addListener(a.setMode),d.events.onModeSelect.addListener(a.setMode),a.events.onModeChange.addListener(function(a){var b,e,f,h;h=[g,k,i,d];for(e=0,f=h.length;e<f;e++)b=h[e],b.eventModeSelect(a);return c.bbq.pushState({m:a})}),g.onSelect=function(){j!=null&&h();return c("*[data-types=Text]").hide()},k.onSelect=function(){j!=null&&h();return c("*[data-types=Text]").hide()},i.onSelect=function(){j!=null&&h();return c("*[data-types=Text]").show()};return d.onSelect=function(){var a;j=c("*[data-types=Text]").parent(),c("*[data-types=Text]").parent().remove(),a=/(col-[^-]+?-)(\d+)/g.exec(c("*[data-types=Image]").parent()[0].className),c("*[data-types=Image]").parent()[0].className=a[1]+parseInt(a[2])*2;return c("*[data-types=Image]").trigger("resetPres")}}]))}});return b.namespace("LimitViewControls",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?a.call(arguments,0):[];return d.initInstance.apply(d,["SGA.Reader.Component.LimitViewControls"].concat(a.call(b),[function(a,b){var d;d=c(b),a.options.onModeChange.addListener(function(a){if(a!=="normal"){c(b).fadeTo(1,.3);return c(b).find("input").prop("disabled",!0)}c(b).fadeTo(1,1);return c(b).find("input").prop("disabled",!1)}),d.find("#hand-view_2").change(function(){var a;if(c(this).is(":checked")){a=".canvas[data-types] .hand-pbs{ color:#a54647; } \n.canvas[data-types] *:not(.hand-pbs), .canvas[data-types] .DeletionAnnotation:not(.hand-pbs){ color:#D9D9D9; }\n.canvas[data-types] .DeletionAnnotation.hand-pbs{ color:#a54647; }",c("#LimitViewControls_classes").remove();return c("<style type='text/css' id='LimitViewControls_classes'>"+a+"</style>").appendTo("head")}}),d.find("#hand-view_1").change(function(){var a;if(c(this).is(":checked")){a=".canvas[data-types] *:not(.hand-pbs), .canvas[data-types] .DeletionAnnotation.hand-pbs{ color:#a54647; }\n.canvas[data-types] .hand-pbs{ color:#D9D9D9; } \n.canvas[data-types] .hand-library{ color:#D9D9D9; } \n.canvas[data-types] .hand-comp{ color:#D9D9D9; } \n.canvas[data-types] .DeletionAnnotation:not(.hand-pbs){ color:#a54647 }\n.canvas[data-types] .DeletionAnnotation.hand-library{ color:#D9D9D9 }\n.canvas[data-types] .DeletionAnnotation.hand-comp{ color:#D9D9D9 }",c("#LimitViewControls_classes").remove();return c("<style type='text/css' id='LimitViewControls_classes'>"+a+"</style>").appendTo("head")}});return d.find("#hand-view_0").change(function(){if(c(this).is(":checked"))return c("#LimitViewControls_classes").remove()})}]))}})}),e.namespace("Controller",function(b){return b.namespace("ModeSelector",function(b){return b.initInstance=function(){var b,c;b=1<=arguments.length?a.call(arguments,0):[];return(c=d.Controller).initInstance.apply(c,["SGA.Reader.Controller.ModeSelector"].concat(a.call(b),[function(a,b){var c;c=[],a.applyBindings=function(a,b){var d;c.push(a),d=a.locate(""),a.$clickHandler=function(d){var e,f,g,h;d.preventDefault(),a.events.onModeSelect.fire(b.mode),h=[];for(f=0,g=c.length;f<g;f++)e=c[f],h.push(typeof e.eventModeSelect=="function"?e.eventModeSelect(b.mode):void 0);return h},d.bind("click",a.$clickHandler),a.eventModeSelect=function(c){if(b.mode===c){if(!d.hasClass("active")){d.addClass("active");return a.onSelect()}}else if(d.hasClass("active")){d.removeClass("active");return a.onUnselect()}},a.onSelect=function(){};return a.onUnselect=function(){}};return a.removeBindings=function(a){var b;c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b!==a&&f.push(b);return f}();return el.unbind("click",a.$clickHandler)}}]))}})});return e.namespace("Application",function(e){return e.namespace("SharedCanvas",function(f){f.initInstance=function(){var e,f;e=1<=arguments.length?a.call(arguments,0):[];return(f=d.Application).initInstance.apply(f,["SGA.Reader.Application.SharedCanvas"].concat(a.call(e),[function(a){var e,f,g,h,i,j,k,l;j=a.options,k=[],a.addPresentation=function(b){var c;c=SGA.Reader.Presentation.Canvas.initInstance(b.container,{types:b.types,application:function(){return a},dataView:a.dataView.canvasAnnotations});return k.push([c,b.container])},e=null,a.events.onSequenceChange.addListener(function(b){var d,f,g,h,i,j;e=b,i=a.dataStore.data.getItem(e),d=c.param.fragment(window.location.href),h=c.deparam(d),f=parseInt(h.n),h.n==null||i.sequence.length<(j=f-1)||j<0?((i!=null?i.sequence:void 0)!=null&&(g=i.sequence.indexOf(a.getCanvas())),g<0&&(g=0)):g=f-1;return a.setPosition(g)}),a.events.onPositionChange.addListener(function(b){var c,d,f;d=a.dataStore.data.getItem(e),c=(f=d.sequence)!=null?f[b]:void 0,a.lockPosition(),a.setCanvas(c);return a.unlockPosition()}),a.events.onCanvasChange.addListener(function(b){var c,d,f,g,h,i;a.dataView.canvasAnnotations.setKey(b),h=a.dataStore.data.getItem(e),g=h.sequence.indexOf(b),g>=0&&g!==a.getPosition()&&(a.lockCanvas(),a.setPosition(g),a.unlockCanvas()),f=(i=h.sequence)!=null?i[g]:void 0,c=a.dataView.canvasAnnotations.items(),c.length>0&&(a.dataView.canvasAnnotations.removeItems(c),d=a.getAnnotationsForCanvas(f),a.dataStore.data.removeItems(d)),Q.nfcall(a.loadCanvas,b).then(function(){return setTimeout(function(){var a,c,d,e;e=[];for(c=0,d=k.length;c<d;c++)a=k[c],e.push(a[0].setCanvas(b));return e},100)});return b}),i=SGA.Reader.Data.Manifest.initInstance(),a.events.onItemsProcessedChange=i.events.onItemsProcessedChange,a.events.onItemsToProcessChange=i.events.onItemsToProcessChange,a.getItemsProcessed=i.getItemsProcessed,a.getItemsToProcess=i.getItemsToProcess,a.setItemsProcessed=i.setItemsProcessed,a.setItemsToProcess=i.setItemsToProcess,a.addItemsProcessed=i.addItemsProcessed,a.addItemsToProcess=i.addItemsToProcess,a.addManifestData=i.importFromURL,a.getAnnotationsForCanvas=i.getAnnotationsForCanvas,a.flushSearchResults=i.flushSearchResults,a.getSearchResultCanvases=i.getSearchResultCanvases,l=SGA.Reader.Data.TextStore.initInstance(),a.withSource=l.withFile,f=function(a,c){var d,e,f,g;if(c!=null){e=i.getItem(c);if(b.call(e.type,"oaFragmentSelector")<0){e.oaxbegin!=null&&(a.start=parseInt((f=e.oaxbegin)!=null?f[0]:void 0,10));if(e.oaxend!=null)return a.end=parseInt((g=e.oaxend)!=null?g[0]:void 0,10)}else if(e.rdfvalue[0].substr(0,5)==="xywh="){a.shape="Rectangle",d=e.rdfvalue[0].substr(5).split(","),a.x=parseInt(d[0],10),a.y=parseInt(d[1],10),a.width=parseInt(d[2],10);return a.height=parseInt(d[3],10)}}},h=function(a,c){var d,e,g;if(c!=null){e=i.getItem(c);if(b.call(e.type,"oaSpecificResource")<0)return a.target=c;a.target=e.oahasSource,e.oahasStyle!=null&&(d=i.getItem(e.oahasStyle[0]),b.call(d.dcformat,"text/css")>=0&&(a.css=d.cntchars)),e.sgahasClass!=null&&(a.cssclass=e.sgahasClass[0]);return f(a,(g=e.oahasSelector)!=null?g[0]:void 0)}},g=function(a,b){var c,d;if(b!=null){c=i.getItem(b),l.addFile(c.oahasSource),a.source=c.oahasSource;return f(a,(d=c.oahasSelector)!=null?d[0]:void 0)}},a.loadCanvas=function(e,j){var k,l,m,n,o,p;l=Q.defer(),m=[],p={},o=[],n=d.initSynchronizer(),k=i.getAnnotationsForCanvas(e),a.addItemsToProcess(k.length),n.process(k,function(d){var e,j,k,l,n,q,r,s,t,u,v,w;a.addItemsProcessed(1),e=i.getItem(d),j=null,n={id:d},b.call(e.type,"scContentAnnotation")<0?b.call(e.type,"scImageAnnotation")<0?b.call(e.type,"scZoneAnnotation")<0?(q=function(){var a,b,c,d;c=e.type,d=[];for(a=0,b=c.length;a<b;a++)k=c[a],k.substr(0,3)==="sga"&&k.substr(k.length-10)==="Annotation"&&d.push(k.substr(3));return d}(),q.length>0&&(h(n,(w=e.oahasTarget)!=null?w[0]:void 0),e.sgatextAlignment!=null&&(n.align=e.sgatextAlignment),e.sgatextIndentLevel!=null&&(n.indent=e.sgatextIndentLevel),n.type=q,j=o)):(r=i.getItem(e.oahasTarget),f(n,(v=r.hasSelector)!=null?v[0]:void 0),j=m,n.target=r.hasSource,n.label=e.rdfslabel,n.type="ZoneAnnotation"):(l=i.getItem(e.oahasBody),c.isArray(l)&&(l=l[0]),j=m,n.target=e.oahasTarget,n.label=e.rdfslabel,n.image=l.oahasSource||e.oahasBody,n.type="Image",b.call(l.dcformat,"image/jp2")>=0&&a.imageControls!=null&&l.schasRelatedService!=null&&(n.type="ImageViewer",n.url=l.schasRelatedService[0]+"?url_ver=Z39.88-2004&rft_id="+n.image[0])):(h(n,(t=e.oahasTarget)!=null?t[0]:void 0),g(n,(u=e.oahasBody)!=null?u[0]:void 0),n.start!=null&&n.end!=null&&(p[s=n.source]==null&&(p[s]=[]),p[n.source].push([d,n.start,n.end])),n.text!=null?n.type="ContentAnnotation":n.type="TextContentZone",j=m);if(n.type!=null&&j!=null)return j.push(n)}),n.done(function(){a.addItemsToProcess(1+o.length);return a.dataStore.data.loadItems(m,function(){var d,e,f,g,h,i,j,k,n,q,r,s,t;m=[],g={},f={},e={},i=function(a){var b,d,h,i,j,k,l,m;i=a.indent,b=a.align,j=a.target,k=a.start,d=a.end,h=a.id,c.isArray(h)&&(h=h[0]),e[h]=a,g[j]==null&&(g[j]={}),(l=g[j])[k]==null&&(l[k]=[]),g[j][k].push(h),f[j]==null&&(f[j]={}),(m=f[j])[d]==null&&(m[d]=[]);return f[j][d].push(h)};for(q=0,s=o.length;q<s;q++)d=o[q],i(d);k=function(){var a;a=[];for(h in g)a.push(h);return a}(),a.addItemsToProcess(k.length),a.addItemsProcessed(o.length),n=function(d){return a.withSource(d,function(i){var j,k,l,m,n,o,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;B=[],t=[],k=!1,A=function(a,b,c,e,f,g,h){var k;g==null&&(g=null),h==null&&(h=null),k={type:a,css:b.join(" "),text:i.slice(e,f),id:d+"-"+e+"-"+f,target:c,start:e,end:f},g!=null&&(k.indent=g),typeof j!="undefined"&&j!==null&&(k.align=j);return B.push(k)},z=function(a,b){var d,f,g,h,i;d=[],f=[];for(h=0,i=t.length;h<i;h++)g=t[h],d.push(e[g].type),e[g].cssclass!=null&&d.push(e[g].cssclass),c.isArray(e[g].css)?f.push(e[g].css.join(" ")):f.push(e[g].css);d.length===0&&d.push("Text");return r(a,b,d,f)},r=function(a,b,c,e,f,g){var i,j,k,l,m;m=p[d]||[];for(k=0,l=m.length;k<l;k++)i=m[k],a<=i[2]&&b>=i[1]&&(h=Math.min(Math.max(a,i[1]),i[2]),j=Math.max(Math.min(b,i[2]),i[1]),A(c,e,i[0],h,j,f,g));return!1},q=function(a,b,c){var d;d=["LineBreak"];return r(a,a,d,[""],b,c)},u=g[d]||[],s=f[d]||[],o=0,y=function(){var a;a=[];for(w in u)a.push(parseInt(w,10));return a}().concat(function(){var a;a=[];for(w in s)a.push(parseInt(w,10));return a}()).sort(function(a,b){return a-b});for(C=0,E=y.length;C<E;C++){x=y[C];if(x!==o){z(o,x),k&&!i.substr(o,x-o).match(/^\s*$/)&&(k=!1),v=!1,I=u[x]||[];for(D=0,F=I.length;D<F;D++)l=I[D],b.call(e[l].type,"LineAnnotation")>=0&&(v=!0),t.push(l);J=s[x]||[];for(H=0,G=J.length;H<G;H++)l=J[H],b.call(e[l].type,"LineAnnotation")>=0&&(v=!0),m=t.indexOf(l),m>-1&&t.splice(m,1);v&&!k&&(n=null,j=null,e[l].indent!=null&&(n=e[l].indent),e[l].align!=null&&(j=e[l].align),q(x,n,j),k=!0),o=x}}z(o,i.length);return a.dataStore.data.loadItems(B,function(){return a.addItemsProcessed(1)})})};for(r=0,t=k.length;r<t;r++)j=k[r],n(j);l.resolve();return a.addItemsProcessed(1)})}),j!=null&&j();return l.promise},j.url!=null&&i.importFromURL(j.url,function(){var b,c,e,f,g,h,j;c=[],h=d.initSynchronizer(),b=i.getCanvases(),a.addItemsToProcess(b.length),h.process(b,function(b){var d,e,f;a.addItemsProcessed(1),d=i.getItem(b);return c.push({id:b,type:"Canvas",width:parseInt((e=d.exifwidth)!=null?e[0]:void 0,10),height:parseInt((f=d.exifheight)!=null?f[0]:void 0,10),label:d.dctitle||d.rdfslabel})}),j=i.getZones(),a.addItemsToProcess(j.length),h.process(j,function(b){var d,e,f,g;a.addItemsProcessed(1),d=i.getItem(b);return c.push({id:b,type:"Zone",width:parseInt((e=mitem.exifwidth)!=null?e[0]:void 0,10),height:parseInt((f=mitem.exifheight)!=null?f[0]:void 0,10),angle:parseInt((g=mitem.scnaturalAngle)!=null?g[0]:void 0,10)||0,label:d.rdfslabel})}),g=i.getSequences(),a.addItemsToProcess(g.length),h.process(g,function(b){var d,e;a.addItemsProcessed(1),e=i.getItem(b),d={id:b,type:"Sequence",label:e.rdfslabel},g=[],g.push(e.rdffirst[0]),e=i.getItem(e.rdfrest[0]);while(e.id!=null)g.push(e.rdffirst[0]),e=i.getItem(e.rdfrest[0]);d.sequence=g;return c.push(d)}),f=i.getRanges(),a.addItemsToProcess(f.length),h.process(f,function(b){var d,e,f;a.addItemsProcessed(1),f=i.getItem(b),e={id:b,type:"Range",label:f.rdfslabel},d=[],d.push(f.rdffirst[0]),f=i.getItem(f.rdfrest[0]);while(f.id!=null)d.push(f.rdffirst[0]),f=i.getItem(f.rdfrest[0]);e.canvases=d;return c.push(e)}),e=i.getLayers(),a.addItemsToProcess(e.length),h.process(e,function(b){var d,e,f,g,h,j,k,l,m,n,o;a.addItemsProcessed(1),l=i.getItem(b),k={id:b,type:"Layer",label:l.rdfslabel,motivation:(o=l.scforMotivation)!=null?o[0]:void 0},j=[],j.push(l.rdffirst[0]),l=i.getItem(l.rdfrest[0]);while(l.id!=null)j.push(l.rdffirst[0]),l=i.getItem(l.rdfrest[0]);if(k.motivation==="http://www.shelleygodwinarchive.org/ns1#reading"||k.motivation==="http://www.shelleygodwinarchive.org/ns1#source"){f=[];for(m=0,n=j.length;m<n;m++)h=j[m],l=i.getItem(h),d=i.getItem(l.rdffirst[0]),f.push(d.id),g=i.getItem(d.id[0]),e={id:g.id[0],type:"LayerAnno",motivation:k.motivation,body:g.oahasBody[0],canvas:d.oahasTarget[0]},c.push(e);k.annotations=f}k.canvases=j;return c.push(k)});return h.done(function(){return a.dataStore.data.loadItems(c)})}),a.getManifestURI=function(){var a;a=i.getManifests();if(a.length>0)return a[0];return null},a.getRangeMetadata=function(a){var b,c,d;c={},b=i.getItem(a),c.rangeTitle=(d=b.rdfslabel)!=null?d[0]:void 0;return c},a.getManifestMetadata=function(b){var c,d,e,f,g,h,j,k,l,m;d={},b==null&&(b=a.getManifestURI()),b!=null&&(c=i.getItem(b),d.workTitle=(e=c.dctitle)!=null?e[0]:void 0,d.workNotebook=(f=c.rdfslabel)!=null?f[0]:void 0,d.workAuthor=(g=c.scagentLabel)!=null?g[0]:void 0,d.workHands=(h=c.sgahandLabel)!=null?h[0]:void 0,d.workDate=(j=c.scdateLabel)!=null?j[0]:void 0,d.workState=(k=c.sgastateLabel)!=null?k[0]:void 0,d.workInstitution=(l=c.scattributionLabel)!=null?l[0]:void 0,d.workShelfmark=(m=c.sgashelfmarkLabel)!=null?m[0]:void 0);return d};return a.getCanvasMetadata=function(b){var c,e,f,g,h,j,k,l,m,n,o,p;e=a.getManifestMetadata(),c=i.getItem(b),e.canvasTitle=(h=c.rdfslabel)!=null?h[0]:void 0,((j=c.dctitle)!=null?j[0]:void 0)!=null&&(e.workTitle=c.dctitle[0]),((k=c.scagentLabel)!=null?k[0]:void 0)!=null&&(e.workAuthor=c.scagentLabel[0]),((l=c.sgahandLabel)!=null?l[0]:void 0)!=null&&(e.workHands=c.sgahandLabel[0]),((m=c.scdateLabel)!=null?m[0]:void 0)!=null&&(e.workDate=c.scdateLabel[0]),((n=c.sgastateLabel)!=null?n[0]:void 0)!=null&&(e.workState=c.sgastateLabel[0]);if((o=c.scattributionLabel)!=null?o[0]:void 0)e.workInstitution=c.scattributionLabel[0];((p=c.sgashelfmarkLabel)!=null?p[0]:void 0)!=null&&(e.workShelfmark=c.sgashelfmarkLabel[0]),f=a.dataStore.data.getSubjectsUnion(d.Data.Set.initInstance([b]),"canvases"),g={},f.visit(function(b){var c;c=a.getRangeMetadata(b);if(c.rangeTitle!=null){e.rangeTitle||(e.rangeTitle=[]);return e.rangeTitle.push(c.rangeTitle)}});return e}}]))};return f.builder=function(a){var b,d,f,g,h,i,j,k;d={manifests:{}},b={},f=function(){},g=function(){},i=function(){},h=function(){},a.spinner!=null&&(i=function(){var b,c,e,f,g;f=d.manifests,g=[];for(b in f)c=f[b],e=c.getItemsToProcess(),g.push(c.events.onItemsToProcessChange.addListener(function(b){if(b>e)return a.spinner.hide()}));return g}),a.progressTracker!=null&&(f=function(){var b,c,e,f,g;e=0,b=0,g=d.manifests;for(c in g)f=g[c],e+=f.getItemsProcessed(),b+=f.getItemsToProcess();a.progressTracker.setNumerator(e);return a.progressTracker.setDenominator(b||1)},j=null,k=1e3,g=function(){if(j!=null)return k=500;j=function(){var b,c,e;e=d.manifests;for(b in e){c=e[b];if(c.getItemsToProcess()>c.getItemsProcessed()){a.progressTracker.show(),k/=2,k<500&&(k=500),setTimeout(j,k);return}}k>500&&a.progressTracker.hide(),k*=2,k>1e4&&(k=1e4);return setTimeout(j,k)};return j()}),a.searchBox!=null&&(a.searchBox.getServiceURL()!=null?(c.param.fragment.noEscape(":,/|"),h=function(b){var e,f,g,h,i;g=a.searchBox.getServiceURL()+b,h=d.manifests,i=[];for(e in h)f=h[e],f.flushSearchResults(),i.push(f.addManifestData(g,function(){var a,b,d,e,g,h,i,j,k,l;g=f.getPosition(),h=f.getSequence(),i=f.dataStore.data.getItem(h),a=(l=i.sequence)!=null?l[g]:void 0,b=f.getSearchResultCanvases(),e=[];for(j=0,k=b.length;j<k;j++)d=b[j],e.push(c.inArray(d,i.sequence));c(".canvas").trigger("searchResultsChange",[e]);return Q.fcall(f.loadCanvas,a).then(function(){setTimeout(function(){return f.setPosition(-1,0)});return setTimeout(function(){return f.setPosition(g,0)})})}));return i},a.searchBox.events.onQueryChange.addListener(function(a){return h(a)})):console.log("You must specify the URL to some search service.")),d.onManifest=function(a,c){if(d.manifests[a]!=null)return d.manifests[a].ready(function(){return c(d.manifests[a])});b[a]==null&&(b[a]=[]);return b[a].push(c)},d.addPresentation=function(j){var k,l,m,n;l=c(j).data("manifest");if(l!=null){k=d.manifests[l],k==null&&(k=e.SharedCanvas.initInstance({url:l}),d.manifests[l]=k,k.ready(function(){var a,c,d,e;c=b[l]||[];for(d=0,e=c.length;d<e;d++)a=c[d],a(k);return delete b[l]}),k.events.onItemsToProcessChange.addListener(f),k.events.onItemsProcessedChange.addListener(f),g(),i(),a.searchBox!=null&&k.ready(function(){var a;if(k.getSequence()==null)return a=k.events.onSequenceChange.addListener(function(){var b,d;d=function(a){a=a.replace(/:/g,"="),a=a.replace(/\|/g,"&");return h(a)},b=c.bbq.getState("s"),b!=null&&d(b);return a()})})),k.run(),m=(n=c(j).data("types"))!=null?n.split(/\s*,\s*/):void 0;return d.onManifest(l,function(a){return a.addPresentation({types:m,container:c(j)})})}},a["class"]==null&&(a["class"]=".canvas"),c(a["class"]).each(function(a,b){return d.addPresentation(b)});return d}})})})})(jQuery,MITHgrid),MITHgrid.defaults("SGA.Reader.Application.SharedCanvas",{dataStores:{data:{types:{Sequence:{},Canvas:{}},properties:{target:{valueType:"item"}}}},dataViews:{canvasAnnotations:{dataStore:"data",type:MITHgrid.Data.SubSet,expressions:["!target"]},sequences:{dataStore:"data",types:["Sequence"]}},variables:{Canvas:{is:"lrw"},Sequence:{is:"rw"},Position:{is:"lrw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Component.Slider",{variables:{Min:{is:"rw",isa:"numeric"},Max:{is:"rw",isa:"numeric"},Value:{is:"rw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Component.PagerControls",{variables:{Min:{is:"rw",isa:"numeric"},Max:{is:"rw",isa:"numeric"},Value:{is:"rw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Component.SequenceSelector",{variables:{Sequence:{is:"rw"}}}),MITHgrid.defaults("SGA.Reader.Component.ProgressBar",{variables:{Numerator:{is:"rw","default":0,isa:"numeric"},Denominator:{is:"rw","default":1,isa:"numeric"}},viewSetup:'<div class="progress progress-striped active">\n  <div class="bar" style="width: 0%;"></div>\n</div>'}),MITHgrid.defaults("SGA.Reader.Component.Spinner",{viewSetup:'<i class="icon-spinner icon-spin icon-3x"></i>'}),MITHgrid.defaults("SGA.Reader.Presentation.Canvas",{variables:{Canvas:{is:"rw"},Scale:{is:"rw",isa:"numeric"},ImgOnly:{is:"rw"},Height:{is:"rw",isa:"numeric"},Width:{is:"rw",isa:"numeric"},X:{is:"rw",isa:"numeric"},Y:{is:"rw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Presentation.TextContent",{variables:{Height:{is:"rw",isa:"numeric"},Width:{is:"rw",isa:"numeric"},X:{is:"rw",isa:"numeric"},Y:{is:"rw",isa:"numeric"},Scale:{is:"rw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Presentation.Zone",{variables:{Height:{is:"rw",isa:"numeric"},Width:{is:"rw",isa:"numeric"},X:{is:"rw",isa:"numeric"},Y:{is:"rw",isa:"numeric"},Scale:{is:"rw",isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Data.Manifest",{variables:{ItemsToProcess:{is:"rw","default":0,isa:"numeric"},ItemsProcessed:{is:"rw","default":0,isa:"numeric"}}}),MITHgrid.defaults("SGA.Reader.Component.ImageControls",{variables:{Active:{is:"rw","default":!1},Zoom:{is:"rw","default":0,isa:"numeric"},MaxZoom:{is:"rw","default":0,isa:"numeric"},MinZoom:{is:"rw","default":0,isa:"numeric"},ImgPosition:{is:"rw","default":{}}}}),MITHgrid.defaults("SGA.Reader.Component.SearchBox",{variables:{Field:{is:"rw","default":!1},Query:{is:"rw","default":!1},ServiceURL:{is:"rw","default":!1}}}),MITHgrid.defaults("SGA.Reader.Component.ModeControls",{variables:{Mode:{is:"rw","default":"normal"}}}),MITHgrid.defaults("SGA.Reader.Controller.ModeSelector",{bind:{events:{onModeSelect:null}}})}).call(this);